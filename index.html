<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>AceTalk | Simple Messenger</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --skype-blue: #00aff0;
            --sidebar-bg: #2c3e50;
            --chat-bg: #ffffff;
            --call-green: #2ecc71;
            --call-red: #e74c3c;
            --call-gray: #7f8c8d;
        }

        * { box-sizing: border-box; border-radius: 0 !important; }

        body, html {
            height: 100%; margin: 0;
            font-family: 'Ubuntu', sans-serif;
            font-weight: 300; overflow: hidden;
            background-color: var(--sidebar-bg);
        }

        /* --- ARAMA PANELÄ° --- */
        #call-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(26, 37, 47, 0.98);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000; color: white;
        }
        .call-content { text-align: center; }
        .control-btn { background: var(--call-gray); color: white; border: none; padding: 12px 20px; font-weight: 700; cursor: pointer; }
        .control-btn.active-off { background: var(--call-red); }
        .hangup-btn { background: var(--call-red); color: white; border: none; padding: 15px 45px; font-weight: 700; cursor: pointer; }

        /* --- SPLASH --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--sidebar-bg);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999;
            transition: transform 0.8s cubic-bezier(0.85, 0, 0.15, 1);
        }
        .loaded #splash-screen { transform: translateY(-100%); }
        .splash-slogan { 
            color: #ffffff; 
            font-size: 14px; 
            letter-spacing: 3px; 
            margin-top: 15px; 
            opacity: 0.9; 
            font-weight: 300;
            text-transform: lowercase;
        }

        /* --- ANA UYGULAMA --- */
        .app-container { display: flex; height: 100vh; width: 100vw; opacity: 0; transition: opacity 0.6s ease-in; transition-delay: 0.7s; }
        .loaded .app-container { opacity: 1; }

        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; display: flex; flex-direction: column; padding: 20px; border-right: 1px solid #1a252f; }
        .brand-name { color: var(--skype-blue); font-size: 28px; font-weight: 700; margin-bottom: 5px; }
        .sidebar-slogan { font-size: 10px; color: #7f8c8d; margin-bottom: 25px; text-transform: uppercase; }

        .lang-switcher { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 15px; }
        .lang-btn { padding: 5px; background: #34495e; border: 1px solid #1a252f; color: white; cursor: pointer; font-size: 10px; }
        .lang-btn.active { background: var(--skype-blue); font-weight: 700; }

        .my-status { padding: 10px; background: rgba(0,0,0,0.2); font-size: 12px; margin-bottom: 20px; }
        .profile-input { width: 100%; background: #34495e; border: none; color: #00ffcc; padding: 8px; margin-top: 5px; font-family: 'Ubuntu'; outline: none; }

        .id-input-group { margin-top: auto; display: flex; flex-direction: column; gap: 5px; }
        .id-input-group input { width: 100%; background: #1a252f; color: #00ffcc; border: 1px solid #111; padding: 8px; outline: none; }
        .action-btn { width: 100%; padding: 10px; border: none; color: white; font-weight: 700; cursor: pointer; }
        .connect-btn { background: var(--skype-blue); }
        .call-btn { background: var(--call-green); }

        .main-chat { flex: 1; display: flex; flex-direction: column; background: var(--chat-bg); position: relative; }
        #chat-box { flex: 1; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        #empty-hint { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ccc; font-size: 20px; pointer-events: none; }

        .msg { max-width: 75%; padding: 10px 15px; border: 1px solid #eee; line-height: 1.5; }
        .local { background: #f0faff; align-self: flex-end; border: 1px solid var(--skype-blue); }
        .remote { background: #f9f9f9; align-self: flex-start; border: 1px solid #ddd; }
        .chat-img { max-width: 100%; display: block; margin-top: 5px; border-radius: 4px !important; }

        .input-area { padding: 20px; display: flex; gap: 10px; border-top: 1px solid #eee; align-items: stretch; background: white; }
        input#message-input { flex: 1; padding: 15px; border: 1px solid #ddd; outline: none; font-size: 14px; }
        #send-btn { width: 120px; background: var(--skype-blue); color: white; border: none; font-weight: 700; cursor: pointer; }

        /* SAÄž PANEL GÃœNCELLEMESÄ° */
        .right-online-bar { width: 220px; background: var(--sidebar-bg); border-left: 1px solid #1a252f; display: flex; flex-direction: column; padding: 20px 15px; color: white; }
        .online-title { 
            font-size: 16px; /* YazÄ± boyutu bÃ¼yÃ¼tÃ¼ldÃ¼ */
            font-weight: 700; 
            color: var(--skype-blue); 
            margin-bottom: 15px; 
            text-transform: uppercase; 
            border-bottom: 2px solid #34495e; /* Ã‡izgi belirginleÅŸtirildi */
            padding-bottom: 8px; 
            letter-spacing: 1px;
        }
        #online-list { flex: 1; overflow-y: auto; }
        .online-item { padding: 10px 0; font-size: 11px; color: #bdc3c7; display: flex; align-items: center; gap: 8px; border-bottom: 1px solid #34495e; }
        .online-dot { width: 8px; height: 8px; background: var(--call-green); border-radius: 50% !important; flex-shrink: 0; }
    </style>
</head>
<body>

<div id="call-overlay">
    <div class="call-content">
        <h2>AceTalk Voice</h2>
        <p id="call-status-text">ARANIYOR...</p>
        <div class="call-controls">
            <button id="btn-mute" class="control-btn" onclick="toggleMute()">MIK: AÃ‡IK</button>
            <button id="btn-deafen" class="control-btn" onclick="toggleDeafen()">SES: AÃ‡IK</button>
        </div>
        <button class="hangup-btn" id="btn-hangup" onclick="endCall()">KAPAT</button>
    </div>
</div>

<div id="splash-screen">
    <h1 style="color: var(--skype-blue); font-weight: 700; font-size: 52px; margin-bottom: 0;">AceTalk</h1>
    <p class="splash-slogan">simple messenger.</p>
</div>

<div class="app-container">
    <div class="sidebar">
        <h1 class="brand-name">AceTalk</h1>
        <div class="sidebar-slogan">Simple Messenger</div>
        <div class="lang-switcher">
            <button id="btn-tr" class="lang-btn active" onclick="setLanguage('tr')">TR</button>
            <button id="btn-en" class="lang-btn" onclick="setLanguage('en')">EN</button>
            <button id="btn-de" class="lang-btn" onclick="setLanguage('de')">DE</button>
            <button id="btn-ru" class="lang-btn" onclick="setLanguage('ru')">RU</button>
        </div>
        <div class="my-status">
            <b id="lbl-profile">PROFILIM:</b>
            <input type="text" id="my-name-input" class="profile-input" value="AceUser">
            <small style="display:block; margin-top:10px;">ID: <span id="my-id">...</span></small>
        </div>
        <div class="id-input-group">
            <label id="lbl-target" style="font-size: 10px;">BAÄžLAN (ID):</label>
            <input type="text" id="peer-id-input" placeholder="ID...">
            <button class="action-btn connect-btn" id="connect-btn" onclick="connectToPeer()">BAÄžLAN</button>
            <button class="action-btn call-btn" id="call-btn" onclick="startCall()">SESLÄ° ARA</button>
        </div>
    </div>
    
    <div class="main-chat">
        <div id="empty-hint">Hadi bir ÅŸey yaz...</div>
        <div id="chat-box"></div>
        <div class="input-area">
            <label for="file-input" class="file-label" style="display: flex; align-items: center; justify-content: center; padding: 0 15px; background: #eee; cursor: pointer; font-size: 18px;">ðŸ“·</label>
            <input type="file" id="file-input" accept="image/*" onchange="sendImage(this)" style="display:none;">
            <input type="text" id="message-input" placeholder="Mesaj yaz..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button id="send-btn" onclick="sendMessage()">GÃ–NDER</button>
        </div>
    </div>

    <div class="right-online-bar">
        <div class="online-title" id="lbl-online-title">Ã‡EVRÄ°MÄ°Ã‡Ä°</div>
        <div id="online-list"></div>
    </div>
</div>

<audio id="remote-audio" autoplay></audio>

<script>
    window.addEventListener('load', () => setTimeout(() => document.body.classList.add('loaded'), 2500));

    const peer = new Peer();
    let connections = [];
    let currentCall = null, localStream = null;
    let isMuted = false, isDeafened = false, currentLang = 'tr';

    const langs = {
        tr: { profile: "PROFILIM:", target: "BAÄžLAN (ID):", connect: "BAÄžLAN", call: "SESLÄ° ARA", input: "Mesaj yaz...", send: "GÃ–NDER", hint: "Hadi bir ÅŸey yaz...", hangup: "KAPAT", micOn: "MIK: AÃ‡IK", micOff: "MIK: KAPALI", volOn: "SES: AÃ‡IK", volOff: "SES: KAPALI", sys: "Sistem", connected: "BaÄŸlandÄ±.", onlineTitle: "Ã‡EVRÄ°MÄ°Ã‡Ä°" },
        en: { profile: "MY PROFILE:", target: "CONNECT (ID):", connect: "CONNECT", call: "VOICE CALL", input: "Type a message...", send: "SEND", hint: "Say something...", hangup: "HANG UP", micOn: "MIC: ON", micOff: "MIC: OFF", volOn: "VOL: ON", volOff: "VOL: OFF", sys: "System", connected: "Connected.", onlineTitle: "ONLINE" },
        de: { profile: "MEIN PROFIL:", target: "VERBINDEN (ID):", connect: "VERBINDEN", call: "ANRUFEN", input: "Nachricht...", send: "SENDEN", hint: "Schreib etwas...", hangup: "AUFLEGEN", micOn: "MIK: AN", micOff: "MIK: AUS", volOn: "TON: AN", volOff: "TON: AUS", sys: "System", connected: "Verbunden.", onlineTitle: "AKTIV" },
        ru: { profile: "ÐœÐžÐ™ ÐŸÐ ÐžÐ¤Ð˜Ð›Ð¬:", target: "ID Ð¦Ð•Ð›Ð˜:", connect: "ÐŸÐžÐ”ÐšÐ›Ð®Ð§Ð˜Ð¢Ð¬Ð¡Ð¯", call: "Ð—Ð’ÐžÐÐžK", input: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ...", send: "ÐžÐ¢ÐŸÐ ÐÐ’Ð˜Ð¢Ð¬", hint: "ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ...", hangup: "Ð—ÐÐ’Ð•Ð Ð¨Ð˜Ð¢Ð¬", micOn: "ÐœÐ˜Ðš: Ð’ÐšÐ›", micOff: "ÐœÐ˜Ðš: Ð’Ð«ÐšÐ›", volOn: "Ð—Ð’Ð£Ðš: Ð’ÐšÐ›", volOff: "Ð—Ð’Ð£Ðš: Ð’Ð«ÐšÐ›", sys: "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð°", connected: "ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾.", onlineTitle: "Ð’ Ð¡Ð•Ð¢Ð˜" }
    };

    peer.on('open', id => document.getElementById('my-id').innerText = id);
    peer.on('connection', conn => setupConn(conn));

    function connectToPeer() {
        const pid = document.getElementById('peer-id-input').value;
        if(!pid || connections.find(c => c.peer === pid)) return;
        setupConn(peer.connect(pid));
    }

    function setupConn(conn) {
        conn.on('open', () => {
            if(!connections.find(c => c.peer === conn.peer)) {
                connections.push(conn);
                updateOnlineList();
                addMessage(langs[currentLang].sys, langs[currentLang].connected, "remote");
            }
        });
        conn.on('data', data => {
            if(data.image) addImageMessage(data.name, data.image, "remote");
            else addMessage(data.name || "AceTalker", data.msg || data, "remote");
        });
        conn.on('close', () => {
            connections = connections.filter(c => c.peer !== conn.peer);
            updateOnlineList();
        });
    }

    function updateOnlineList() {
        const list = document.getElementById('online-list');
        list.innerHTML = "";
        connections.forEach(c => {
            list.innerHTML += `<div class="online-item"><div class="online-dot"></div> ${c.peer.substring(0,12)}...</div>`;
        });
    }

    function sendMessage() {
        const i = document.getElementById('message-input'), myName = document.getElementById('my-name-input').value;
        if(i.value) {
            const data = { name: myName, msg: i.value };
            connections.forEach(c => c.send(data));
            addMessage("", i.value, "local");
            i.value = "";
        }
    }

    function sendImage(input) {
        if(input.files && input.files[0]) {
            const reader = new FileReader();
            const myName = document.getElementById('my-name-input').value;
            reader.onload = e => {
                const data = { name: myName, image: e.target.result };
                connections.forEach(c => c.send(data));
                addImageMessage("", e.target.result, "local");
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function addMessage(u, t, type) {
        const h = document.getElementById('empty-hint'); if(h) h.remove();
        const b = document.getElementById('chat-box');
        const header = u ? `<strong>${u}:</strong> ` : "";
        b.innerHTML += `<div class="msg ${type}">${header}${t}</div>`;
        b.scrollTop = b.scrollHeight;
    }

    function addImageMessage(u, src, type) {
        const h = document.getElementById('empty-hint'); if(h) h.remove();
        const b = document.getElementById('chat-box');
        const header = u ? `<strong>${u}:</strong> ` : "";
        b.innerHTML += `<div class="msg ${type}">${header}<img src="${src}" class="chat-img"></div>`;
        b.scrollTop = b.scrollHeight;
    }

    peer.on('call', call => {
        navigator.mediaDevices.getUserMedia({audio: true}).then(stream => {
            localStream = stream; openCallOverlay(); call.answer(stream); currentCall = call;
            call.on('stream', rs => document.getElementById('remote-audio').srcObject = rs);
        });
    });

    function startCall() {
        const pid = document.getElementById('peer-id-input').value;
        if(!pid) return;
        navigator.mediaDevices.getUserMedia({audio: true}).then(stream => {
            localStream = stream; openCallOverlay(); currentCall = peer.call(pid, stream);
            currentCall.on('stream', rs => document.getElementById('remote-audio').srcObject = rs);
        }).catch(() => { alert("Mic Error!"); closeCallOverlay(); });
    }

    function toggleMute() { if(localStream) { isMuted = !isMuted; localStream.getAudioTracks()[0].enabled = !isMuted; updateBtnStates(); } }
    function toggleDeafen() { isDeafened = !isDeafened; document.getElementById('remote-audio').muted = isDeafened; updateBtnStates(); }
    
    function updateBtnStates() {
        const m = document.getElementById('btn-mute'), d = document.getElementById('btn-deafen'), l = langs[currentLang];
        m.innerText = isMuted ? l.micOff : l.micOn; m.className = isMuted ? "control-btn active-off" : "control-btn";
        d.innerText = isDeafened ? l.volOff : l.volOn; d.className = isDeafened ? "control-btn active-off" : "control-btn";
    }

    function setLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-'+lang).classList.add('active');
        const l = langs[lang];
        document.getElementById('lbl-profile').innerText = l.profile;
        document.getElementById('lbl-target').innerText = l.target;
        document.getElementById('connect-btn').innerText = l.connect;
        document.getElementById('call-btn').innerText = l.call;
        document.getElementById('send-btn').innerText = l.send;
        document.getElementById('message-input').placeholder = l.input;
        document.getElementById('btn-hangup').innerText = l.hangup;
        document.getElementById('lbl-online-title').innerText = l.onlineTitle;
        if(document.getElementById('empty-hint')) document.getElementById('empty-hint').innerText = l.hint;
        updateBtnStates();
    }

    function endCall() { if(currentCall) currentCall.close(); if(localStream) localStream.getTracks().forEach(t => t.stop()); closeCallOverlay(); }
    function openCallOverlay() { document.getElementById('call-overlay').style.display = 'flex'; updateBtnStates(); }
    function closeCallOverlay() { document.getElementById('call-overlay').style.display = 'none'; }
</script>
</body>
</html>
